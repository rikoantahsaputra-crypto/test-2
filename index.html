<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Kepegawaian RSDS</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI}
body{background:#f4f6f9;color:#1f2937}
.wrapper{max-width:1200px;margin:auto;padding:15px;position:relative}

/* LOGIN */
.login-card{
max-width:430px;margin:auto;
background:#1e3a8a;color:#fff;padding:35px;border-radius:20px;
box-shadow:0 10px 25px rgba(0,0,0,.2);text-align:center}
.login-card input{
width:100%;padding:14px;border-radius:10px;
border:none;margin:15px 0}
.login-card button{
width:100%;padding:14px;border:none;
border-radius:10px;background:#2563eb;
color:#fff;font-weight:600}
.loading{display:none;margin-top:10px;font-size:13px}

/* HEADER */
.header{text-align:center;margin-bottom:15px}
.welcome{font-size:22px;font-weight:700;}
.nama-user{font-size:16px;margin-top:4px;color:#374151}

/* DROPDOWN */
.top-menu{position:absolute;top:15px;right:15px;z-index:100;}
.menu-btn{
width:34px;height:34px;border-radius:50%;background:#fff;
display:flex;align-items:center;justify-content:center;
box-shadow:0 4px 10px rgba(0,0,0,.15);cursor:pointer;font-weight:bold;}
.dropdown{
display:none;position:absolute;right:0;margin-top:6px;
background:#fff;border-radius:10px;
box-shadow:0 6px 15px rgba(0,0,0,.15);overflow:hidden;}
.dropdown div{padding:10px 14px;font-size:13px;cursor:pointer;}
.dropdown div:hover{background:#f3f4f6;}

/* MESSAGE */
.message-header{
background:#1e3a8a;color:#fff;padding:12px;border-radius:12px;
display:flex;justify-content:space-between;
cursor:pointer;margin-bottom:10px}
.message-box{
display:none;background:#fff;border-radius:12px;
padding:10px;max-height:200px;overflow-y:auto;
border:1px solid #e5e7eb}
.message-card{padding:8px 0;border-bottom:1px solid #eee;font-size:13px}

/* TABS */
.tabs{
display:flex;
position:sticky;
top:0;
z-index:50;
background:#f4f6f9;
padding-bottom:5px;
}
.tab{
flex:1;text-align:center;padding:10px;
background:#e5e7eb;cursor:pointer;font-size:14px}
.tab.active{background:#1e3a8a;color:#fff}

/* CONTENT AREA */
.content-area{
height:70vh;
overflow-y:auto;
}

/* SLIDER */
.slider{display:flex;transition:transform .3s ease}
.slide{min-width:100%;flex-shrink:0}

/* CARD */
.riwayat-card{
background:#fff;border-radius:14px;
padding:14px;margin-bottom:10px;
border:1px solid #e5e7eb;font-size:13px}
.folder-link{
display:inline-block;margin-top:6px;
color:#2563eb;text-decoration:none;font-weight:600}

/* GRID */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
.menu{
background:#fff;border-radius:14px;padding:18px;
text-align:center;border:1px solid #e5e7eb;
cursor:pointer;transition:.15s}
.menu:hover{box-shadow:0 6px 18px rgba(0,0,0,.1)}
.menu span{font-size:26px;display:block;margin-bottom:6px}

/* PROFIL */
.profil-card{
background:#fff;border-radius:16px;
padding:16px;border:1px solid #e5e7eb;
font-size:13px;line-height:1.6}
.update-btn{
display:block;margin-top:12px;padding:10px;
background:#1e3a8a;color:#fff;text-align:center;
border-radius:10px;text-decoration:none}

/* DESKTOP */
@media (min-width:1024px){
.layout{
display:grid;
grid-template-columns:240px 1fr;
gap:25px;
}
.sidebar{
background:#fff;border-radius:16px;
padding:20px;border:1px solid #e5e7eb;
}
.sidebar-item{
padding:10px;border-radius:10px;
cursor:pointer;margin-bottom:8px;
}
.sidebar-item.active,
.sidebar-item:hover{
background:#1e3a8a;color:#fff;
}
.tabs{display:none;}
}
</style>
</head>

<body>
<div class="wrapper">

<div id="loginBox" class="login-card">
<h2>Kepegawaian RSDS</h2>
<input id="nip" placeholder="Masukkan NIP / NIK">
<button onclick="login()">Masuk</button>
<div id="loading" class="loading">Memverifikasi...</div>
</div>

<div id="dashboard" style="display:none">

<div class="top-menu">
<div class="menu-btn" onclick="toggleDropdown()">‚ãÆ</div>
<div class="dropdown" id="dropdown">
<div onclick="logout()">Keluar Aplikasi</div>
</div>
</div>

<div class="layout">

<div class="sidebar" id="sidebarMenu" style="display:none;">
<div class="sidebar-item active" onclick="goSlide(0)">Riwayat</div>
<div class="sidebar-item" onclick="goSlide(1)">Layanan</div>
<div class="sidebar-item" onclick="goSlide(2)">Profil</div>
</div>

<div>

<div class="header">
<div class="welcome">Welcome To Kepegawaian RSDS</div>
<div class="nama-user" id="namaUser"></div>
</div>

<div id="messageContainer"></div>

<div class="tabs">
<div class="tab active" onclick="goSlide(0)">Riwayat</div>
<div class="tab" onclick="goSlide(1)">Layanan</div>
<div class="tab" onclick="goSlide(2)">Profil</div>
</div>

<div class="content-area">
<div class="slider" id="slider">
<div class="slide" id="riwayatSlide"></div>
<div class="slide" id="layananSlide"></div>
<div class="slide" id="profilSlide"></div>
</div>
</div>

</div>
</div>
</div>
</div>

<script>
const GAS_URL="https://script.google.com/macros/s/AKfycbyjYOjeXz2sJame1uf5sEjutY04B1RghTek5WmTbKb0qso_uJcLNjWoucbify9CvJ8m/exec";
let globalData=null;

/* FORMAT TANGGAL */
function formatDate(val){
if(!val) return "-";
if(typeof val !== "string") return val;
if(val.includes("T")) val = val.split("T")[0];
const parts = val.split("-");
if(parts.length===3) return parts[2]+"-"+parts[1]+"-"+parts[0];
return val;
}

window.onload=()=>{
if(window.innerWidth>=1024)
document.getElementById("sidebarMenu").style.display="block";
const session=localStorage.getItem("rsds_session");
if(session) fetchData(session);
};

function login(){
const nip=document.getElementById("nip").value.trim();
if(!nip) return;
localStorage.setItem("rsds_session",nip);
fetchData(nip);
}

function fetchData(nip){
document.getElementById("loading").style.display="block";
fetch(GAS_URL,{method:"POST",body:JSON.stringify({nip})})
.then(r=>r.json())
.then(r=>{
if(!r.status){alert(r.message);logout();return;}
globalData=r.data;
document.getElementById("loginBox").style.display="none";
document.getElementById("dashboard").style.display="block";
document.getElementById("namaUser").innerText=
"Sdr/i "+(globalData.profile.NAMA||globalData.profile.nama||"");
renderAll();
});
}

function renderAll(){
renderPesan();
renderRiwayat();
renderLayanan();
renderProfil();
}

function renderPesan(){
if(!globalData.pesan||!globalData.pesan.length) return;
let html=`<div class="message-header" onclick="toggleMsg()">
<div>Pesan dari Bagian Kepegawaian</div>
<div>${globalData.pesan.length}</div>
</div>
<div class="message-box" id="msgBox">`;
globalData.pesan.forEach(m=>{
html+=`<div class="message-card">${m.text}
<div style="font-size:11px;color:#6b7280">${formatDate(m.time)}</div></div>`;
});
html+="</div>";
document.getElementById("messageContainer").innerHTML=html;
}

function toggleMsg(){
const b=document.getElementById("msgBox");
b.style.display=b.style.display==="block"?"none":"block";
}

function renderRiwayat(){
let h="<div style='margin-bottom:8px;font-size:13px;color:#6b7280'>Pantau Pengajuan Layanan Secara Berkala</div>";
if(!globalData.riwayat||!globalData.riwayat.length){
h+="<div style='text-align:center;color:#9ca3af'>Belum ada aktivitas</div>";
}else{
globalData.riwayat.forEach(x=>{
h+=`<div class="riwayat-card"><b>${x.judul||"-"}</b><br>`;
Object.entries(x.detail).forEach(([k,v])=>{
if(k==="TIMESTAMP") return;
if(String(v).startsWith("http")){
h+=`<a href="${v}" target="_blank" class="folder-link">üìÇ Buka Folder</a>`;
}else{
h+=`<div>${k}: ${formatDate(v)}</div>`;
}
});
h+="</div>";
});
}
document.getElementById("riwayatSlide").innerHTML=h;
}

function renderLayanan(){
document.getElementById("layananSlide").innerHTML=
`<div class="grid">
<div class="menu" onclick="openUrl('https://rikoantah.github.io/pangkat-rsds-aktive/')"><span>üë§</span>Pangkat</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/Gaji-Berkala-RSDS-Soedarso/')"><span>üí∞</span>Gaji Berkala</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/Ukom-Rsds/')"><span>üìù</span>UKOM</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/Jafung-D/')"><span>üíº</span>Jabatan Fungsional</div>
<div class="menu" onclick="openUrl('https://rikoantahsaputra94-jpg.github.io/Tampilan-Cuti-Umpar/')"><span>üìÖ</span>Cuti</div>
<div class="menu" onclick="openUrl('https://script.google.com/macros/s/AKfycbwAwouQ9BK6S9GzQeFtkUxKQJY_iunIfS35Jfe0wYD8L7A6-C5InI7IkFW4eSOnEKQz/exec')"><span>üßÆ</span>Angka Kredit</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/sip-sib/')"><span>ü™™</span>SIP / SIB</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/slks-d/')"><span>‚≠ê</span>SLKS</div>
</div>`;
}

function renderProfil(){
let p=globalData.profile;
let h=`<div class="profil-card">`;
Object.entries(p).forEach(([k,v])=>{
h+=`<div><b>${k}</b><br>${formatDate(v)}</div><br>`;
});
h+="</div>";
document.getElementById("profilSlide").innerHTML=h;
}

function goSlide(i){
const slider=document.getElementById("slider");
slider.style.transform=`translateX(-${i*100}%)`;
document.querySelectorAll(".tab").forEach((t,idx)=>t.classList.toggle("active",idx===i));
document.querySelectorAll(".sidebar-item").forEach((t,idx)=>t.classList.toggle("active",idx===i));
}

function openUrl(url){window.open(url,"_blank");}
function toggleDropdown(){
const d=document.getElementById("dropdown");
d.style.display=d.style.display==="block"?"none":"block";
}
function logout(){
localStorage.removeItem("rsds_session");
location.reload();
}
</script>

</body>
</html>
