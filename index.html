<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WEB UMPAR RSDS</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI}
body{background:#f3f5f9;color:#222}
.container{max-width:430px;margin:auto;padding:15px;position:relative}

/* LOGIN */
.login-card{
background:linear-gradient(135deg,#1e3c72,#2a5298);
color:#fff;padding:35px;border-radius:22px;
box-shadow:0 15px 40px rgba(0,0,0,.3);text-align:center
}
.login-card input{width:100%;padding:14px;border-radius:12px;border:none;margin:15px 0}
.login-card button{width:100%;padding:14px;border:none;border-radius:12px;background:#00c6ff;color:#fff;font-weight:bold}
.loading{display:none;margin-top:10px;font-size:13px}

/* TOP MENU */
.top-menu{
position:absolute;top:15px;right:15px;
}
.menu-btn{
background:#fff;border-radius:50%;
width:36px;height:36px;
display:flex;align-items:center;justify-content:center;
box-shadow:0 4px 10px rgba(0,0,0,.15);
cursor:pointer;font-weight:bold
}
.dropdown{
display:none;
position:absolute;right:0;margin-top:5px;
background:#fff;border-radius:10px;
box-shadow:0 6px 15px rgba(0,0,0,.15);
overflow:hidden
}
.dropdown div{
padding:10px 15px;font-size:13px;
cursor:pointer
}
.dropdown div:hover{background:#f0f0f0}

/* WELCOME */
.welcome{
margin-bottom:5px;
font-size:14px;color:#555
}
.nama-user{
font-size:18px;font-weight:600;
margin-bottom:10px
}

/* MESSAGE */
.message-header{
background:linear-gradient(90deg,#ff512f,#dd2476);
color:#fff;padding:14px;border-radius:16px;
display:flex;justify-content:space-between;
cursor:pointer;margin-bottom:10px
}
.message-box{
display:none;
background:#fff;
border-radius:14px;
padding:10px;
max-height:200px;
overflow-y:auto;
box-shadow:0 6px 15px rgba(0,0,0,.1)
}
.message-card{
background:#fff8e1;
border-left:4px solid #ff9800;
padding:10px;margin-bottom:8px;
border-radius:10px;font-size:13px
}

/* TABS */
.tabs{display:flex;gap:8px;margin-bottom:12px}
.tab{flex:1;text-align:center;padding:10px;border-radius:12px;background:#e0e0e0;cursor:pointer}
.tab.active{background:#1e88e5;color:#fff}

/* CARD STYLE */
.card{
border-radius:20px;
padding:16px;margin-bottom:12px;
box-shadow:0 10px 25px rgba(0,0,0,.15);
font-size:13px;color:#fff
}
.card-riwayat{
background:linear-gradient(135deg,#667eea,#764ba2);
}
.card-profil{
background:linear-gradient(135deg,#00b09b,#96c93d);
}

/* GRID LAYANAN */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
.menu{
background:#fff;border-radius:18px;padding:20px;text-align:center;
box-shadow:0 8px 20px rgba(0,0,0,.08);
cursor:pointer;transition:.15s
}
.menu:active{transform:scale(.96)}
.menu span{font-size:30px;display:block;margin-bottom:8px}
</style>
</head>

<body>
<div class="container">

<div id="loginBox" class="login-card">
<h2>WEB UMPAR RSDS</h2>
<input id="nip" placeholder="Masukkan NIP / NIK">
<button onclick="login()">Masuk</button>
<div id="loading" class="loading">Memverifikasi...</div>
</div>

<div id="dashboard" style="display:none">

<div class="top-menu">
<div class="menu-btn" onclick="toggleDropdown()">‚ãÆ</div>
<div class="dropdown" id="dropdown">
<div onclick="logout()">Keluar</div>
</div>
</div>

<div class="welcome">Welcome di Web Umpar RSDS</div>
<div class="nama-user" id="namaUser"></div>

<div id="messageContainer"></div>

<div class="tabs">
<div class="tab active" onclick="showTab(0)">Riwayat</div>
<div class="tab" onclick="showTab(1)">Layanan</div>
<div class="tab" onclick="showTab(2)">Profil</div>
</div>

<div id="tabContent"></div>

</div>
</div>

<script>
const GAS_URL="https://script.google.com/macros/s/AKfycbw9w6wPyncNC2q_1_XLpx3JYeF7CsIcVFa_Kyi_62jIpfHDLuXni9bQu38hcuKBGYBy/exec";
let globalData=null;

window.onload=()=>{
const session=localStorage.getItem("rsds_session");
if(session){
fetchData(session,true);
}
};

function login(){
const nip=document.getElementById("nip").value.trim();
if(!nip) return;
localStorage.setItem("rsds_session",nip);
fetchData(nip,false);
}

function fetchData(nip,isAuto){
document.getElementById("loading").style.display="block";
fetch(GAS_URL,{method:"POST",body:JSON.stringify({nip})})
.then(r=>r.json())
.then(r=>{
if(!r.status){alert(r.message);logout();return;}
globalData=r.data;
document.getElementById("loginBox").style.display="none";
document.getElementById("dashboard").style.display="block";
document.getElementById("namaUser").innerText=
"Sdr/i "+(globalData.profile.NAMA||globalData.profile.nama||"");
renderPesan();
showTab(0);
});
}

function renderPesan(){
if(!globalData.pesan.length) return;
let html=`<div class="message-header" onclick="toggleMsg()">
<div>üì¢ Pesan Penting</div>
<div>${globalData.pesan.length}</div>
</div>
<div class="message-box" id="msgBox">`;
globalData.pesan.forEach(m=>{
html+=`<div class="message-card">${m.text}
<div style="font-size:11px;color:#777">${m.time}</div></div>`;
});
html+="</div>";
document.getElementById("messageContainer").innerHTML=html;
}

function toggleMsg(){
const b=document.getElementById("msgBox");
b.style.display=b.style.display==="block"?"none":"block";
}

function showTab(i){
document.querySelectorAll(".tab").forEach((t,idx)=>{
t.classList.toggle("active",idx===i);
});
if(i===0) renderRiwayat();
if(i===1) renderLayanan();
if(i===2) renderProfil();
}

function renderRiwayat(){
let h="<div style='margin-bottom:10px;font-size:13px;color:#666'>Pantau Pengajuan Layanan Secara Berkala</div>";
if(!globalData.riwayat.length){
h+="<div style='text-align:center;color:#777'>Belum ada aktivitas</div>";
}else{
globalData.riwayat.forEach(x=>{
h+=`<div class="card card-riwayat"><b>${x.sheet.toUpperCase()}</b><br>`;
Object.entries(x.detail).forEach(([k,v])=>{
if(k==="TIMESTAMP") return;
if(String(v).startsWith("http")){
h+=`<div style="margin-top:6px">
<a href="${v}" target="_blank" style="color:#fff;text-decoration:none">
üìÇ Buka Folder
</a></div>`;
}else{
h+=`<div>${k}: ${v}</div>`;
}
});
h+="</div>";
});
}
document.getElementById("tabContent").innerHTML=h;
}

function renderLayanan(){
document.getElementById("tabContent").innerHTML=`
<div class="grid">
<div class="menu" onclick="openUrl('https://rikoantah.github.io/pangkat-rsds-aktive/')"><span>üë§</span>Pangkat</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/Gaji-Berkala-RSDS-Soedarso/')"><span>üí∞</span>Gaji Berkala</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/Ukom-Rsds/')"><span>üìù</span>UKOM</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/Jafung-D/')"><span>üíº</span>Jabatan Fungsional</div>
<div class="menu" onclick="openUrl('https://rikoantahsaputra94-jpg.github.io/Tampilan-Cuti-Umpar/')"><span>üìÖ</span>Cuti</div>
<div class="menu" onclick="openUrl('https://script.google.com/macros/s/AKfycbwAwouQ9BK6S9GzQeFtkUxKQJY_iunIfS35Jfe0wYD8L7A6-C5InI7IkFW4eSOnEKQz/exec')"><span>üßÆ</span>Angka Kredit</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/sip-sib/')"><span>ü™™</span>SIP / SIB</div>
<div class="menu" onclick="openUrl('https://rikoantah.github.io/slks-d/')"><span>‚≠ê</span>SLKS</div>
</div>`;
}

function renderProfil(){
let h=`<div class="card card-profil">`;
Object.entries(globalData.profile).forEach(([k,v])=>{
h+=`<div><b>${k}</b>: ${v||"-"}</div>`;
});
h+=`<div style="margin-top:10px;font-size:12px">
Jika ada data yang belum update silahkan kirimkan perubahan data.
</div>
<div style="margin-top:10px">
<a href="#" style="color:#fff;text-decoration:underline">Permohonan Update Data</a>
</div></div>`;
document.getElementById("tabContent").innerHTML=h;
}

function openUrl(url){
window.open(url,"_blank");
}

function toggleDropdown(){
const d=document.getElementById("dropdown");
d.style.display=d.style.display==="block"?"none":"block";
}

function logout(){
localStorage.removeItem("rsds_session");
location.reload();
}
</script>

</body>
</html>
