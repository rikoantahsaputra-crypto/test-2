<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WEB UMPAR RSDS</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI}
body{background:#f3f5f9;color:#222}
.container{max-width:430px;margin:auto;padding:15px}

/* LOGIN */
.login-card{
background:linear-gradient(135deg,#1e3c72,#2a5298);
color:#fff;padding:35px;border-radius:22px;
box-shadow:0 15px 40px rgba(0,0,0,.3);text-align:center
}
.login-card input{width:100%;padding:14px;border-radius:12px;border:none;margin:15px 0}
.login-card button{width:100%;padding:14px;border:none;border-radius:12px;background:#00c6ff;color:#fff;font-weight:bold}
.loading{display:none;margin-top:10px;font-size:13px}

/* PROFILE HEADER */
.profile-header{
background:#fff;border-radius:18px;padding:15px;
box-shadow:0 8px 20px rgba(0,0,0,.08);
margin-bottom:12px;font-weight:600
}

/* MESSAGE */
.message-header{
background:linear-gradient(90deg,#ff512f,#dd2476);
color:#fff;padding:14px;border-radius:16px;
display:flex;justify-content:space-between;
cursor:pointer;margin-bottom:10px
}
.message-box{
display:none;
background:#fff;
border-radius:14px;
padding:10px;
max-height:220px;
overflow-y:auto;
box-shadow:0 6px 15px rgba(0,0,0,.1)
}
.message-card{
background:#fff8e1;
border-left:4px solid #ff9800;
padding:10px;margin-bottom:8px;
border-radius:10px;font-size:13px
}

/* TABS */
.tabs{display:flex;gap:8px;margin-bottom:12px}
.tab{flex:1;text-align:center;padding:10px;border-radius:12px;background:#e0e0e0;cursor:pointer}
.tab.active{background:#1e88e5;color:#fff}

/* CARD */
.card{
background:linear-gradient(135deg,#667eea,#764ba2);
color:#fff;border-radius:20px;
padding:16px;margin-bottom:12px;
box-shadow:0 10px 25px rgba(0,0,0,.15);
font-size:13px
}

/* PROFILE TAB */
.profile-box{
background:#fff;border-radius:18px;
padding:15px;box-shadow:0 6px 15px rgba(0,0,0,.1);
font-size:13px;line-height:1.6
}
.update-btn{
display:block;margin-top:12px;
background:#1e88e5;color:#fff;
padding:10px;border-radius:10px;
text-align:center;text-decoration:none
}
.logout{
margin-top:15px;width:100%;padding:14px;
border:none;border-radius:14px;
background:#ff4b5c;color:#fff;font-weight:bold
}
</style>
</head>

<body>
<div class="container">

<div id="loginBox" class="login-card">
<h2>WEB UMPAR RSDS</h2>
<input id="nip" placeholder="Masukkan NIP / NIK">
<button onclick="login()">Masuk</button>
<div id="loading" class="loading">Memverifikasi...</div>
</div>

<div id="dashboard" style="display:none">

<div id="welcome" class="profile-header"></div>

<div id="messageContainer"></div>

<div class="tabs">
<div class="tab active" onclick="showTab(0)">Riwayat</div>
<div class="tab" onclick="showTab(1)">Layanan</div>
<div class="tab" onclick="showTab(2)">Profil</div>
</div>

<div id="tabContent"></div>

<button class="logout" onclick="logout()">Keluar</button>

</div>
</div>

<script>
const GAS_URL="https://script.google.com/macros/s/AKfycbw9w6wPyncNC2q_1_XLpx3JYeF7CsIcVFa_Kyi_62jIpfHDLuXni9bQu38hcuKBGYBy/exec";

let globalData=null;

function login(){
  const nip=document.getElementById("nip").value.trim();
  if(!nip) return;
  document.getElementById("loading").style.display="block";
  fetch(GAS_URL,{method:"POST",body:JSON.stringify({nip})})
  .then(r=>r.json())
  .then(r=>{
    if(!r.status){alert(r.message);return;}
    globalData=r.data;
    document.getElementById("loginBox").style.display="none";
    document.getElementById("dashboard").style.display="block";
    renderAll();
  });
}

function renderAll(){
  const nama=globalData.profile.NAMA||globalData.profile.nama||"";
  document.getElementById("welcome").innerText=
  "Welcome di Web Umpar RSDS Sdr/i "+nama;

  renderPesan();
  showTab(0);
}

function renderPesan(){
  if(!globalData.pesan.length) return;

  let html=`<div class="message-header" onclick="toggleMsg()">
  <div>ðŸ“¢ Pesan Penting</div>
  <div>${globalData.pesan.length}</div>
  </div>
  <div class="message-box" id="msgBox">`;

  globalData.pesan.forEach((m,i)=>{
    html+=`<div class="message-card">${m.text}
    <div style="font-size:11px;color:#777">${m.time}</div></div>`;
  });

  html+="</div>";
  document.getElementById("messageContainer").innerHTML=html;
}

function toggleMsg(){
  const b=document.getElementById("msgBox");
  b.style.display=b.style.display==="block"?"none":"block";
}

function showTab(i){
  document.querySelectorAll(".tab").forEach((t,idx)=>{
    t.classList.toggle("active",idx===i);
  });

  if(i===0) renderRiwayat();
  if(i===1) renderLayanan();
  if(i===2) renderProfil();
}

function renderRiwayat(){
  let h="<div style='margin-bottom:10px;font-size:13px;color:#666'>Pantau Pengajuan Layanan Secara Berkala</div>";
  if(!globalData.riwayat.length){
    h+="<div style='text-align:center;color:#777'>Belum ada aktivitas</div>";
  }else{
    globalData.riwayat.forEach(x=>{
      h+=`<div class="card"><b>${x.sheet.toUpperCase()}</b><br>`;
      Object.entries(x.detail).forEach(([k,v])=>{
        if(k==="TIMESTAMP") return;
        h+=`<div>${k}: ${v}</div>`;
      });
      h+="</div>";
    });
  }
  document.getElementById("tabContent").innerHTML=h;
}

function renderLayanan(){
  document.getElementById("tabContent").innerHTML=
  "<div class='card'>Menu layanan menyusul</div>";
}

function renderProfil(){
  let h="<div class='profile-box'>";
  Object.entries(globalData.profile).forEach(([k,v])=>{
    h+=`<div><b>${k}</b>: ${v||"-"}</div>`;
  });
  h+=`
  <div style="margin-top:10px;color:#c62828;font-size:12px">
  Jika ada data yang belum update silahkan kirimkan perubahan data.
  </div>
  <a href="#" class="update-btn">Permohonan Update Data</a>
  </div>`;
  document.getElementById("tabContent").innerHTML=h;
}

function logout(){
  location.reload();
}
</script>

</body>
</html>
